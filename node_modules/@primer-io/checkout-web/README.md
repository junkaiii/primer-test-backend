<br/>

<h1 align="center"><img src="https://github.com/primer-io/example-web-checkout/blob/master/images/primer-logo.png?raw=true" height="24px"> Primer Web SDK</h1>

<div align="center">
  <h3 align="center">

[Primer's](https://primer.io) Official Universal Checkout Web SDK

  </h3>
</div>

<p align="center">

<img src="https://img.shields.io/npm/v/@primer-io/checkout-web" />
<!-- Potentially add test coverage in the future -->
</p>

<br/>

<div align="center"><img src="https://github.com/primer-io/example-web-checkout/blob/master/images/checkout-banner.gif?raw=true"  width="50%"/></div>

<br/>
<br/>

# üí™ Features of the Web SDK

<p>üí≥ &nbsp; Create great payment experiences with our highly customizable Universal Checkout</p>
<p>üß© &nbsp; Connect and configure any new payment method without a single line of code</p>
<p>‚úÖ &nbsp; Dynamically handle 3DS 2.0 across processors and be SCA ready</p>
<p>‚ôªÔ∏è &nbsp; Store payment methods for one-click checkout, recurring and repeat payments</p>
<p>üì± &nbsp; Proprietary Apple & Google Pay integrations that work with any PSP</p>
<p>üîí &nbsp; Always PCI compliant without redirecting customers</p>

<br/>

# üìö Documentation

Consider looking at the following resources:

- [Documentation](https://primer.io/docs)
- [Client session creation](https://primer.io/docs/accept-payments/manage-client-sessions/#create-a-client-session)
- [API reference](https://apiref.primer.io/docs)
- [Changelogs](https://primer.io/docs/changelog/sdk-changelog/web)

<br/>

# üí° Support

For any support or integration related queries, feel free to [Contact Us](mailto:https://support@primer.io).

<br/>

## üöÄ Quick start

Take a look at our [Quick Start Guide](https://primer.io/docs/integration-builder/) for accepting your first payment with Universal Checkout.

<br/>

# üìã Prerequisites

- üîë Generate a client token by [creating a client session](https://primer.io/docs/api/#operation/create_client_side_token_client_session_post) in your backend
- üß± Prepare a container in which to render Universal Checkout
- üéâ _That's it!_

<br/>

# üß± Installation

## With npm (recommended)

Our Web SDK is available on npm under the name [`@primer-io/checkout-web`](https://www.npmjs.com/package/@primer-io/checkout-web).

This package includes TypeScript definitions.

```bash

# With yarn
yarn add @primer-io/checkout-web

# With npm
npm install --save @primer-io/checkout-web

```

```typescript
import { Primer } from '@primer-io/checkout-web';

Primer.showUniversalCheckout(clientToken, {
  /* Options */
});
```

## With our CDN

Include the `Primer.min.js` script on the page where you want the checkout to be rendered.

Ensure that you're providing the desired version in the script tag. In the case below, it's `v2.0.0`:

```html
<link rel="stylesheet" href="https://sdk.primer.io/web/v2.0.0/Checkout.css" />

<script
  src="https://sdk.primer.io/web/v2.0.0/Primer.min.js"
  crossorigin="anonymous"
></script>
```

`Primer.min.js` will add the Primer object to the global scope:

```typescript
const { Primer } = window;

Primer.showUniversalCheckout(clientToken, {
  /* Options */
});
```

<br/>

## üë©‚Äçüíª Usage

### üîç &nbsp;Rendering the checkout

Availing Universal Checkout is as easy as implementing one line of code:

```javascript
import { Primer } from '@primer-io/checkout-web';

const universalCheckout = await Primer.showUniversalCheckout(
  clientToken,
  options,
);
```

Below is an example of a basic implementation of Universal Checkout:

```javascript
const clientToken = '...'; // client token retrieved from your backend

const options = {
  // Container element which will contain the checkout
  container: '#container',

  onCheckoutComplete({ payment }) {
    // Notifies you that a payment was created
    // Move on to next step in your checkout flow:
    // e.g. Show a success message, giving access to the service, fulfilling the order
  },
};

const universalCheckout = await Primer.showUniversalCheckout(
  clientToken,
  options,
);
```

Note that there are more options which can be passed to Universal Checkout. Please refer to the section below for more information.

<br/>

## üß∞ &nbsp;Checkout Options

When calling `showUniversalCheckout` you can provide Universal Checkout with some configuration options.

These options range from callbacks notifying you of the current payment's status, to styling options for certain UI elements.

Below are some options to consider when integrating Universal Checkout:

### üöÄ **General Options**

#### ‚öôÔ∏è _Container and locale_

| option      | Type                  | Description                                                                               |          |
| ----------- | --------------------- | ----------------------------------------------------------------------------------------- | -------- |
| `container` | `string` or `Element` | The container element in which the checkout should be rendered                            | required |
| `locale`    | `string`              | This option forces the locale. By default, the locale will be set to the browser's locale | optional |

<br/>

#### ‚öôÔ∏è _Payment Lifecycle Callbacks_

Callbacks can be provided to Universal Checkout which will notify you on certain checkout events such as payment creation.

These callbacks can be used to inform you on the current state of the checkout.

We strongly recommend you to implement `onCheckoutComplete` to redirect the user to an order confirmation page when the payment is successful:

```javascript
const options = {
  /* Other checkout options ... */

  onBeforePaymentCreate(data, handler) {
    // Notifies you that a payment will be created
    // Update your UI accordingly
    // e.g. Show custom loading UI, etc.
    // Abort or continue with payment creation
    // Primer will continue with payment creation if onBeforePaymentCreate is not implemented

    // ‚ö†Ô∏è You MUST call one of the functions of the `handler` if `onBeforePaymentCreate` is implemented

    // Choose to abort a payment
    return handler.abortPaymentCreation();

    // Choose to continue with payment creation
    return handler.continuePaymentCreation();
  },

  onCheckoutComplete({ payment }) {
    // Notifies you that a payment was created
    // Move on to next step in your checkout flow:
    // e.g. Show a success message, giving access to the service, fulfilling the order, ...
  },

  onCheckoutFail(error, { payment }, handler) {
    // Notifies you that the checkout flow has failed and a payment could not be created
    // This callback can also be used to display an error state within your own UI.

    // ‚ö†Ô∏è `handler` is undefined if the SDK does not expect anything from you
    if (!handler) {
      return;
    }

    // ‚ö†Ô∏è If `handler` exists, you MUST call one of the functions of the handler

    // Show a default error message
    return handler.showErrorMessage();

    // Show a custom error message
    return handler.showErrorMessage('This is my custom error message');
  },
};
```

<br/>

#### ‚öôÔ∏è _Client Session Lifecycle Callbacks_

Callbacks can be provided to Universal Checkout which will notify you on client session update events.

```javascript
const options = {
  /* Other checkout options ... */

  onBeforeClientSessionUpdate() {
    // Notifies you that the client session is in the process of being updated
    // Use it to show a loading indicator on your UI
  },

  onClientSessionUpdate(clientSession) {
    // Notifies you when the client session has been updated by the checkout
    // Returns updated client session
    // Updated client session can be used to inform your UI
    // e.g. update tax, shipping or discount amounts displayed to your customers
  },
};
```

---

### üí≥ **Payment Methods Options**

Learn more about the [payment method specific options](https://www.notion.so/primerio/Checkout-Documentation-589aeae3387a4025917db6e29810ebaf).

<!--
#### ‚öôÔ∏è _Redirect Options_

Handling redirects is required for Payment Methods like iDeal that present a webpage for the customer to enter their credentials and validate their payment.

When the user selects such a Payment Method, Universal Checkout will first attempt to show the webpage in a popup or a browser tab to maintain the context, and will then safely bring the user back to the initial page to continue the flow.

This however does not work properly in some scenario involving third-party apps through deep linking.

| option                   | Type    | Description                                                                                                                                                      | Default |          |
| ------------------------ | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | -------- |
| `redirect.returnUrl`     | String  | If creating a popup or tab is not possible, Universal Checkout will automatically redirect the user back to this URL.                                            |         | optional |
| `redirect.forceRedirect` | Boolean | Forces redirect instead of using popups. <br /> _This negatively affects the User Experience. We recommend to only use this option in your testing environment._ | false   | optional |

#### ‚öôÔ∏è _Card Options_

These options only apply to the native Card implementation (`PAYMENT_CARD`).

| option                        | Type                                    | Description                                                                                                                                                                                                                       | Default                                      |          |
| ----------------------------- | --------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- | -------- |
| `card.preferredFlow`          | `DEDICATED_SCENE` or `EMBEDDED_IN_HOME` | `DEDICATED_SCENE`<br />Attempt to display a card button in the home scene. Clicking on this button will show the card form. <br /> <br /> `EMBEDDED_IN_HOME`<br /> Attempt to display the entire card form within the home scene. | `EMBEDDED_IN_HOME`                           | optional |
| `card.cardNumber.placeholder` | String                                  | Placeholder for the card number field.                                                                                                                                                                                            | `1234 1234 1234 1234`                        | optional |
| `card.expiryDate.placeholder` | String                                  | Placeholder for the card number field.                                                                                                                                                                                            | Localized version of `MM/YY`                 | optional |
| `card.expiryDate.cvv`         | String                                  | Placeholder for the card number field.                                                                                                                                                                                            | `***` or `****` depending on the card scheme | optional |

---

#### ‚öôÔ∏è _Apple Pay Options_

These options only apply to the native Apple Pay implementation (`APPLE_PAY`).

| option                 | Type                                                                | Description                                  | Default |          |
| ---------------------- | ------------------------------------------------------------------- | -------------------------------------------- | ------- | -------- |
| `applePay.buttonType`  | `plain`, `buy`, `set-up`, `donate`, `check-out`, `book`, `suscribe` | Control the content of the Apple Pay button. | `plain` | optional |
| `applePay.buttonStyle` | `white`, `white-outline`, `black`                                   | Control the style of button.                 | `black` | optional |

#### ‚öôÔ∏è _Google Pay Options_

These options only apply to the native Google Pay implementation (`GOOGLE_PAY`).

| option                 | Type                        | Description                                 | Default   |          |
| ---------------------- | --------------------------- | ------------------------------------------- | --------- | -------- |
| `googlePay.buttonType` | `long`, `short`             | Control the size of the Google Pay button.  | `long`    | optional |
| `google.buttonColor`   | `default`, `black`, `white` | Control the color of the Google Pay button. | `default` | optional |

#### ‚öôÔ∏è _PayPal Options_

These options only apply to the native PayPal implementation (`PAYPAL`).

| option               | Type                                                           | Description                                                                                                                                                                                                                                                                                                     | Default   |          |
| -------------------- | -------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | -------- |
| `paypal.buttonColor` | `gold`, `blue`, `silver`, `white`, `black`                     | Control the color of the PayPal button.                                                                                                                                                                                                                                                                         | `gold`    | optional |
| `paypal.buttonLabel` | `checkout`, `credit`, `pay`, `buynow`, `paypal`, `installment` | Control the label written in the PayPal button.                                                                                                                                                                                                                                                                 | `PayPal`  | optional |
| `paypal.paymentFlow` | `DEFAULT`, `PREFER_VAULT`                                      | `DEFAULT`<br />Prepare everything to make a payment with PayPal. <br /><br />`PREFER_VAULT`<br />Vaut PayPal before making a payment. <br />Make sure the [`customerId`](https://apiref.primer.io/reference/create_client_side_token_client_session_post#request.body.customerId) is set in the client session. | `DEFAULT` | optional |

#### ‚öôÔ∏è _Klarna Options_

These options only apply to the native Klarna implementation (`KLARNA`).

| option                               | Type                                                               | Description                                                                                                                                                                                                                                                                                                     | Default                                     |          |
| ------------------------------------ | ------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------- | -------- |
| `klarna.recurringPaymentDescription` | String                                                             | ¬†Payment description used for recurring payments                                                                                                                                                                                                                                                                |                                             | optional |
| `klarna.allowedPaymentCategories`    | Array of categories <br /> `pay_now`, `pay_later`, `pay_over_time` | List of categories allowed to be presented to the customer                                                                                                                                                                                                                                                      | `['pay_now', 'pay_later', 'pay_over_time']` | optional |
| `klarna.paymentFlow`                 | `DEFAULT`, `PREFER_VAULT`                                          | `DEFAULT`<br />Prepare everything to make a payment with Klarna. <br /><br />`PREFER_VAULT`<br />Vaut Klarna before making a payment. <br />Make sure the [`customerId`](https://apiref.primer.io/reference/create_client_side_token_client_session_post#request.body.customerId) is set in the client session. | `DEFAULT`                                   | optional |

-->

---

### üé® **Customization Options**

Learn more about the [customization options](https://primer.io/docs/accept-payments/customize-universal-checkout/web).

#### ‚öôÔ∏è _Styling_

| option  | Type   | Description                                                                                                                                                                              | Default       |          |
| ------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- | -------- |
| `style` | Object | Custom style applied to the UI. <br /> Learn more about the capabilities in our [Customization Guide](docs/accept-payments/customize-universal-checkout/web/#styling-universal-checkout) | Default style | optional |

#### ‚öôÔ∏è _Form Options_

| option                    | Type    | Description                                   | Default |          |
| ------------------------- | ------- | --------------------------------------------- | ------- | -------- |
| `form.inputLabelsVisible` | Boolean | Choose whether to show the label above inputs | true    | optional |

#### ‚öôÔ∏è _Submit Button Options & Callbacks_

Universal Checkout allows you to use your own submit button for submitting forms. By default, the built-in submit button will be favored:

| option                          | Type    | Description                                                                    | Default |          |
| ------------------------------- | ------- | ------------------------------------------------------------------------------ | ------- | -------- |
| `submitButton.useBuiltInButton` | Boolean | Set whether to use built-in submit button or to display your own custom button | true    | optional |

<br/>

Note that when **disabling** the built-in submit button and using your own custom submit button, it is **required** to implement the `submit()` function in order to notify Universal Checkout of form submissions. <br />
Read more about the `submit()` function in the [Manual Form Submission](#manual-form-submission) section referenced below.

<br/>

When using your own custom submit button, it's important to use the following callbacks to ensure that your submit button is in the correct state and in sync with the checkout as your customers interact with it:

```javascript
const options = {
  /* Other options ... */

  submitButton: {
    useBuiltInButton: false, // Default to true

    // Callback for receiving the submit button's visible state in the current scene
    onVisible(isVisible, context: { currentSceneId }) {
      // Show or hide your custom submit button
    },

    // Callback for receiving the submit button's disabled state in the current scene
    onDisable(isDisabled, context: { currentSceneId }) {
      // Disable or enable your custom submit button
    },

    // Callback for receiving the submit button's loading state in the current scene
    onLoading(isLoading, context: { currentSceneId }) {
      // Show your submit button in a loading state
    },

    // Callback for receiving the submit button's content in the current scene
    onContentChange(content, context: { currentSceneId }) {
      // Set your submit button's content with either the content provided or your own custom content
    },
  },
};
```

<br/>

#### ‚öôÔ∏è _Processing Indicator Options_

Show a processing indicator overlay on top of the checkout when submitting a form:

| option                        | Type    | Description                                                                      | Default |          |
| ----------------------------- | ------- | -------------------------------------------------------------------------------- | ------- | -------- |
| `processingIndicator.visible` | Boolean | Choose whether a processing indicator overlay should be shown on form submission | true    | optional |

<br/>

#### ‚öôÔ∏è _Error Message Options & Callbacks_

When Universal Checkout encounters errors processing payments, these errors will be shown to your users by default, below the submit button.

If you want to show your own error messages, you have the option to disable the default, built-in error messages:

| option                  | Type    | Description                                                       | Default |          |
| ----------------------- | ------- | ----------------------------------------------------------------- | ------- | -------- |
| `errorMessage.disabled` | Boolean | Choose whether to allow Universal Checkout to show error messages | false   | optional |

<br/>

You can use the following callbacks to get notified when Universal Checkout intends to display an error message. By using these callbacks, you can respond with your own UI changes and avail a custom error message:

```javascript
const options = {
  /* Other options ... */

  errorMessage: {
    disabled: false, // Default to false

    // A callback for when the error message should be displayed
    onErrorMessageShow(message) {
      // Choose to use provided message for own purposes
    },

    // A callback for when the error message should be hidden
    onErrorMessageHide() {
      // Update own UI accordingly
    },
  },
};
```

<br/>

#### ‚öôÔ∏è _Success Screen Options_

When the checkout is succefully complete, Universal Checkout displays a success scene with a default success message _"Your payment was successful!"_.

Set the option `successScreen` to modify the behavior of the success scene.

```javascript
const options = {
  /* Other options ... */

  // Remove the success screen
  successScreen: false,

  // Change the message of the default success screen
  successScreen: {
    type: 'CHECK',
    title: 'This is a custom success message!',
  },
};
```

---

### üî® **Advanced Options**

#### ‚öôÔ∏è _Manual Payment Creation & Tokenization Lifecycle Callbacks_

By default, Universal Checkout will automatically create payments and manage their lifecycles on your behalf. The manual payment creation flow used in previous Web SDK versions is still supported.

Check our [Manual Payment Creation guide](https://primer.io/docs/accept-payments/advanced-checkout-configuration/manual).

<!--

By default, Universal Checkout will automatically create payments and manage their lifecycles on your behalf.

The manual payment creation flow used in previous Web SDK versions is still supported. To activate it, make sure to:

- set `paymentHandling` to `MANUAL`
- implement `onTokenizeSuccess` and `onResumeSuccess`

```javascript
const options = {
  /* Other checkout options ... */

  paymentHandling: 'MANUAL',

  async onTokenizeSuccess(paymentMethodTokenData, handler) {
    // Send the Payment Method Token to your server
    // to create a payment using Payments API
    // const response = await createPayment(paymentMethodTokenData.token);

    // Call `handler.handleFailure` to cancel the flow and display an error message
    if (!response) {
      return handler.handleFailure(
        'The payment failed. Please try with another payment method.',
      );
    }

    // If a new clientToken is available, call `handler.continueWithNewClientToken` to refresh the client session.
    // The checkout will automatically perform the action required by the Workflow.
    if (response.requiredAction.clientToken) {
      return hander.continueWithNewClientToken(response.requiredAction.clientToken);
    }

    // Display the success screen
    return hander.handleSuccess();
  },

  async onResumeSuccess(resumeTokenData, handler) {
    // Send the resume token to your server to resume the payment
    // const response = await resumePayment(resumeTokenData.resumeToken);

    // Call `handler.handlehandleFailureError` to cancel the flow and display an error message
    if (!response) {
      return handler.handleFailure(
        'The payment failed. Please try with another payment method.',
      );
    }

    // If a new clientToken is available, call `handler.continueWithNewClientToken` to refresh the client session.
    // The checkout will automatically perform the action required by the Workflow
    if (response.requiredAction.clientToken) {
      return hander.continueWithNewClientToken(response.requiredAction.clientToken);
    }

    // Display the success screen
    return hander.handleSuccess();
  },
};
```

Additional optional callbacks are available:

```javascript
const options = {
  /* Other checkout options ... */

  async onTokenizeShouldStart({ paymentMethodType }) {
    // Return true if tokenization is allowed to start
    return true;

    // Return false if tokenization is not allowed to start
    // This is likely to happen if the user has not properly filled in a form owned by you
    return false;
  },

  onTokenizeDidNotStart(reason) {
    // Tokenization did not start

    if (reason === 'TOKENIZATION_DISABLED') {
      // Tokenization has been disabled with `setTokenizationEnabled`
    } else if (reason === 'TOKENIZATION_SHOULD_NOT_START') {
      // Tokenization has been disabled by returning false in `onTokenizeShouldStart`
    }
  },

  onTokenizeStart() {
    // Tokenization has started
  },

  onResumeError(error) {
    // Resuming has failed
  },
};
```

-->

#### ‚öôÔ∏è _Show the flow for a single payment method_

The payment methods featuring a dedicated screen allows you to directly display their flow. For that, make sure to:

- Set `uxFlow` to `SINGLE_PAYMENT_METHOD_CHECKOUT`
- Set `paymentMethod` to the payment method you want to display

```javascript
const options = {
  /* Other options ... */

  uxFlow: 'SINGLE_PAYMENT_METHOD_CHECKOUT',
  paymentMethod: 'PAYMENT_CARD',
};
```

Payment methods that supports this flow

- Card: `PAYMENT_CARD`
- Klarna: `KLARNA`
- GoCardless: `GOCARDLESS`

#### ‚öôÔ∏è _Customizable Payment Method Button options_

Some payment methods enables you to customize the payment method button.

| option       | Type   | Description                                                                      | Default             |          |
| ------------ | ------ | -------------------------------------------------------------------------------- | ------------------- | -------- |
| `logoSrc`    | String | Data URL representing the logo you want to display in the payment method button. |                     | required |
| `background` | String | Color of the background of the payment method button.                            |                     | required |
| `logoAlt`    | String | Accessibility marker for the payment method button                               |                     | required |
| `text`       | String | Label to display to the right of `logoSrc`                                       | Only show `logoSrc` | optional |

Payment methods that supports this flow

- Gift Cards with Mollie: `PAYMENT_CARD`

## üîß &nbsp;<a id="checkout-methods"></a> Checkout Methods

Universal Checkout exposes some methods which can be called to perform some specific actions:

### **Set Client Token**

When updating the client session, after the checkout has been initialized, you will receive a client token in the response returned from `PATCH /client-session`.

In order for the checkout to know that you have updated the client session, you will need to pass this new client token back to the checkout:

```javascript
const universalCheckout = await Primer.showUniversalCheckout(
  clientToken,
  options,
);

// Pass the new client token to Universal Checkout by calling setClientToken
// This will result in Universal Checkout having access to the latest changes made to the client session
universalCheckout.setClientToken(clientToken);
```

### **Manual Form Submission**

The checkout provides a method for manually calling submit. This is useful when using your own custom submit button.

```javascript
const universalCheckout = await Primer.showUniversalCheckout(
  clientToken,
  options,
);

const handleMySubmitButtonClick = () => {
  // Forward all submit button clicks to the SDK
  universalCheckout.submit();
};
```

<br/>

### **Disabling Tokenization and Payment Creation**

The checkout provides `setPaymentCreationEnabled` and `setTokenizationEnabled` to enable or disable tokenization and payment creation. Use this if you would like to prevent users from paying because your side of the checkout is not valid.

These two functions can be used interchangibly.

```javascript
const universalCheckout = await Primer.showUniversalCheckout(
  clientToken,
  options,
);

// Disable payment creation
universalCheckout.setPaymentCreationEnabled(false);
universalCheckout.setTokenizationEnabled(false);

// Enable payment creation
universalCheckout.setPaymentCreationEnabled(true);
universalCheckout.setTokenizationEnabled(true);
```
